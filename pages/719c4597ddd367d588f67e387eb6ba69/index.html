<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>第一个插件</title>
  <link rel="stylesheet" href="../../public/common.css" />
  <link rel="stylesheet" href="../../public/katex/katex.min.css" />
  <link rel="stylesheet" href="../../public/main.css" />
  <link rel="stylesheet" href="../../public/index.css" />
  <link rel="stylesheet" href="../../public/page.css" />
  <script src="../../public/common.js"></script>
</head>
<body class="close-left-sidebar close-right-sidebar">
  <script>
    if (!storage.get('close-left-sidebar', isMobile)) {
      document.body.classList.remove('close-left-sidebar')
    }
    if (!storage.get('close-right-sidebar', isMobile)) {
      document.body.classList.remove('close-right-sidebar')
    }
  </script>
  <aside class="left-sidebar">
    <header id="sidebarHeader"></header>
    <div class="sidebar-container"></div>
  </aside>
  <main>
    <div class="main-title-bar">
      <div id="titleContainer"></div>
      <div id="toggleNightThemeBtn"></div>
      <div id="toggleOpenRightSidebarBtn"></div>
    </div>
    <div class="main-container"><noscript><strong>We're sorry but note-core-webview doesn't work properly without JavaScript enabled. Please enable it to continue.</strong></noscript><div data-v-79572944="" class="app"><div data-v-79572944="" id="lpnote" class="note lpnote lh-1-5 l 霞鹜文楷-屏幕阅读版-R"><div id="pages" class="note-wrapper"><!----><div id="page-lp-8723-a580" class="lp-page defaultTheme 霞鹜文楷-屏幕阅读版-R align-center"><div class="title"><div contenteditable="false" class="note-title" style="opacity: 1;">第一个插件</div></div><div class="tags-line"></div><div class="title-divider"></div><div id="lp-8723-a580" spellcheck="false" class="note-content ql-container ql-snow show"><div class="ql-editor"  data-placeholder="请输入笔记" spellcheck="false"><h1 data-fold="unfold" id="header-c27f-a6a1"><span data-attr="H1" class="ql-ui" contenteditable="false"></span>0x01 manifest配置文件</h1><p>插件所有的配置都是通过manifest.json文件来控制的，一个基本的内容为</p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">json</span></span><div class="ql-code-block" data-language="json">{</div><div class="ql-code-block" data-language="json">  "name": "my-first-mastergo-plugin",</div><div class="ql-code-block" data-language="json">  "id": 1234567890,</div><div class="ql-code-block" data-language="json">  "api": "1.0.0",</div><div class="ql-code-block" data-language="json">  "main": "./main.js",</div><div class="ql-code-block" data-language="json">  "ui": "./ui.html",</div><div class="ql-code-block" data-language="json">  "menu": [</div><div class="ql-code-block" data-language="json">    {</div><div class="ql-code-block" data-language="json">      "name": "打开主页面",</div><div class="ql-code-block" data-language="json">      "command": "home"</div><div class="ql-code-block" data-language="json">    },</div><div class="ql-code-block" data-language="json">    {</div><div class="ql-code-block" data-language="json">      "name": "执行B功能",</div><div class="ql-code-block" data-language="json">      "command": "run"</div><div class="ql-code-block" data-language="json">    },</div><div class="ql-code-block" data-language="json">  ],</div><div class="ql-code-block" data-language="json">}</div></div><p><br></p><ol><li data-list="bullet" id="li-bbb1-bc2d" data-fold="unfold"><span class="ql-ui" contenteditable="false"></span>name 插件的名称，该名称会出现在插件菜单栏里</li><li data-list="bullet" id="li-0622-83fa" data-fold="unfold"><span class="ql-ui" contenteditable="false"></span>id 每一个插件都有一个唯一id用来标识</li><li data-list="bullet" id="li-6816-e163" data-fold="unfold"><span class="ql-ui" contenteditable="false"></span>api mastergo的api版本，最好用最新的</li><li data-list="bullet" id="li-fbdc-251a" data-fold="unfold"><span class="ql-ui" contenteditable="false"></span>main 相对路径，用来指定在沙盒里执行的javascript脚本</li><li data-list="bullet" id="li-06b4-42a0" data-fold="unfold"><span class="ql-ui" contenteditable="false"></span>ui 相对路径，用户界面要加载的HTML</li><li data-list="bullet" id="li-73b5-6795" data-fold="unfold"><span class="ql-ui" contenteditable="false"></span>menu?:ManifestMenu[] menu选项是一个json数组，设置menu可以为插件添加子菜单入口，并调整菜单结构和分割线的位置，在运行时触发插件的run事件，其参数为选中的菜单中设置command值，也可以通过mg.command获取</li></ol><h1 data-fold="unfold" id="header-0a2b-6e1c"><span data-attr="H1" class="ql-ui" contenteditable="false"></span>0x02 创建插件</h1><p><img class="" data-id="63a3885290a4990f135c98966de8d440" scale="true" src="assets/63a3885290a4990f135c98966de8d440.png"></p><p>有两种方式来创建插件，第一种方式为输入插件名直接创建插件</p><p><img class="" data-id="4f95cdec3fe7bd75df6e4200bd705f96" scale="true" src="assets/4f95cdec3fe7bd75df6e4200bd705f96.png"></p><p>然后选择一种创建模式，保存到本地就行</p><p><img class="" data-id="c555ecd92c6e451ce1c2f4e828391fb5" scale="true" src="assets/c555ecd92c6e451ce1c2f4e828391fb5.png"></p><p>第二种方式是将创建好的配置文件信息拖进去就可以</p><p><img class="" data-id="6c295fe9012636ae909a938bccbbbc1e" scale="true" src="assets/6c295fe9012636ae909a938bccbbbc1e.png"></p><p>一个简单的插件目录结构为</p><p><br></p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">plain</span></span><div class="ql-code-block" data-language="plain">my-plugin</div><div class="ql-code-block" data-language="plain">|- manifest.json</div><div class="ql-code-block" data-language="plain">|- main.js</div><div class="ql-code-block" data-language="plain">|- ui.html</div></div><p><br></p><p>manifest.json内容为</p><p><br></p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">json</span></span><div class="ql-code-block" data-language="json">{</div><div class="ql-code-block" data-language="json">  "name": "my-plugin",</div><div class="ql-code-block" data-language="json">  "id": 82928041410902,</div><div class="ql-code-block" data-language="json">  "api": "1.0.0",</div><div class="ql-code-block" data-language="json">  "main": "index.js",</div><div class="ql-code-block" data-language="json">  "ui": "index.html"</div><div class="ql-code-block" data-language="json">}</div></div><p><br></p><p>ui.html内容为</p><p><br></p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">vbscript-html</span></span><div class="ql-code-block" data-language="vbscript-html">&lt;!DOCTYPE html&gt;</div><div class="ql-code-block" data-language="vbscript-html">&lt;body&gt;</div><div class="ql-code-block" data-language="vbscript-html">    &lt;div class="content"&gt;</div><div class="ql-code-block" data-language="vbscript-html">        &lt;div style="margin-bottom: 20px; color: #fff;"&gt;</div><div class="ql-code-block" data-language="vbscript-html">            输入椭圆的数量：&lt;input type="text" /&gt;</div><div class="ql-code-block" data-language="vbscript-html">        &lt;/div&gt;</div><div class="ql-code-block" data-language="vbscript-html">        &lt;button id="btn"&gt;创建&lt;/button&gt;</div><div class="ql-code-block" data-language="vbscript-html">    &lt;/div&gt;</div><div class="ql-code-block" data-language="vbscript-html">&lt;/body&gt;</div></div><p>index.js内容为</p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">javascript</span></span><div class="ql-code-block" data-language="javascript">mg.showUI(__html__)</div></div><p>运行效果为</p><p><img class="" data-id="cd3011bac488830d5c6250671c989f7f" scale="true" src="assets/cd3011bac488830d5c6250671c989f7f.png"></p><h1 data-fold="unfold" id="header-cfe2-f6cc"><span data-attr="H1" class="ql-ui" contenteditable="false"></span>0x03 向主线程传递消息</h1><p>传递消息主要通过调用 <code>parent.postMessage</code> 函数完成</p><p>html代码添加</p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">plain</span></span><div class="ql-code-block" data-language="plain">    &lt;script&gt;</div><div class="ql-code-block" data-language="plain">        // 获取input输入表单</div><div class="ql-code-block" data-language="plain">        const input = document.querySelector("input")</div><div class="ql-code-block" data-language="plain">        // 绑定按钮click事件</div><div class="ql-code-block" data-language="plain">        document.getElementById("btn").addEventListener("click", (ev) =&gt; {</div><div class="ql-code-block" data-language="plain">            // 发送给主线程</div><div class="ql-code-block" data-language="plain">            parent.postMessage({ count: Number(input.value)}, "*")</div><div class="ql-code-block" data-language="plain">        })</div><div class="ql-code-block" data-language="plain">    &lt;/script&gt;</div></div><p>然后主线程需要监听 <code>onmessage</code> 事件，然后就可以接收iframe传来得数据，index.js需要添加</p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">plain</span></span><div class="ql-code-block" data-language="plain">mg.ui.onmessage = (msg) =&gt; {</div><div class="ql-code-block" data-language="plain">    console.log(msg)</div><div class="ql-code-block" data-language="plain">}</div></div><p>运行效果为</p><p><img class="" data-id="fa9d8eb9686fffdb69f78d69ab3785dc" scale="true" src="assets/fa9d8eb9686fffdb69f78d69ab3785dc.png"></p><p><br></p><h1 data-fold="unfold" id="header-3854-fb1f"><span data-attr="H1" class="ql-ui" contenteditable="false"></span>0x04 调用插件API创建椭圆图层</h1><p>onmessage事件监听的代码改为</p><div class="ql-code-block-container hljs" spellcheck="false"><span class="code ql-ui" contenteditable="false"><span class="code-copy" contenteditable="false">复制</span><span contenteditable="false" class="code-type">javascript</span></span><div class="ql-code-block" data-language="javascript">mg.ui.onmessage = (msg) =&gt; {</div><div class="ql-code-block" data-language="javascript">    const count = msg.count;</div><div class="ql-code-block" data-language="javascript">    for(i = 0; i &lt; count; i++) {</div><div class="ql-code-block" data-language="javascript">        mg.createEllipse()</div><div class="ql-code-block" data-language="javascript">    }</div><div class="ql-code-block" data-language="javascript">}</div></div><p>运行效果为</p><p><img class="" data-id="70b2d32743eea4d4f85010feade9c250" scale="true" src="assets/70b2d32743eea4d4f85010feade9c250.png"></p><p><span class="lp-file" contenteditable="false" data-name="libc-2.31.so" data-preview="libc-2.31.so" data-id="de70156a4396e8a1b8d50b6d2fafd8ed" data-src="assets/de70156a4396e8a1b8d50b6d2fafd8ed.so">﻿<span contenteditable="false"></span>﻿<span contenteditable="false" class="lp-file-content"><span class="lp-file-label">libc-2.31.so</span></span></span></p><p><br></p></div></div><div class="pull-bg"><div class="pull-overflow hide" style="opacity: 0;"></div><div class="header-wrap" style="height: 0px;"><div class="edit-title-tips hide" style="opacity: 0;"><i class="fas fa-arrow-left" style="transform: rotate(0deg);"></i><span>编辑标题</span></div></div></div><!----></div></div><div class="remarks"></div></div><div data-v-79572944="" class="tooltipBody"></div><div data-v-79572944="" class="img-bar btn-secondary btn-event line" style="top: 0px; left: 0px; display: none;"><i data-v-79572944="" class="fa fa-ellipsis-h"></i></div></div><script src="../../public/katex/katex.min.js"></script></div>
  </main>
  <aside class="right-sidebar">
    <header>
      <div class="active">大纲</div>
      <div>备注</div>
    </header>
    <main>
      <div id="headerList" class="list-container active">
        <div class="list-box">
          <div class="placeholder circle-info">暂无页面大纲</div>
        </div>
        <div class="toggle-fold-all">全部折叠/展开</div>
      </div>
      <div id="remarkList" class="list-container">
        <div class="placeholder message-slash">暂无备注</div>
      </div>
    </main>
  </aside>
  <div class="mask"></div>
</body>
</html>
<script src="../../public/index.js"></script>
<script src="../../public/page.js"></script>
      <script>
        window.isOnlyOnePage=false;
        renderRightSidebar([{"id":"header-c27f-a6a1","value":"0x01 manifest配置文件","label":"h1","children":[]},{"id":"header-0a2b-6e1c","value":"0x02 创建插件","label":"h1","children":[]},{"id":"header-cfe2-f6cc","value":"0x03 向主线程传递消息","label":"h1","children":[]},{"id":"header-3854-fb1f","value":"0x04 调用插件API创建椭圆图层","label":"h1","children":[]}], []);
        window.pageId='719c4597ddd367d588f67e387eb6ba69';
      </script><script>generateMenu({"id":"75405673633a339eb120fdc7f7b46282","title":"zepor","children":[{"id":"ab0c5891684fd4ca43cc893c481efe35","title":"其他篇","children":[{"id":"3c31c06e39e3b81b9747b9bf5064ba23","title":"MasteerGo插件","children":[],"pageIdArr":[],"pages":[{"id":"719c4597ddd367d588f67e387eb6ba69","title":"第一个插件","src":"pages/719c4597ddd367d588f67e387eb6ba69/index.html"}]}],"pageIdArr":[],"pages":[{"id":"42abd2919e837ddba06d810fb35f187a","title":"20230421092515","src":"pages/42abd2919e837ddba06d810fb35f187a/index.html"}]}],"pageIdArr":[],"pages":[]}, true)</script>